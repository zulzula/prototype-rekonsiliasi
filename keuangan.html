<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="public/favicon.png" />

    <!-- CoreUI CSS -->
    <link rel="stylesheet" href="css/coreui.min.css" />

    <!-- Icon CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/free.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/brand.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/flag.min.css"
    />

    <title>e-Rekonsiliasi</title>
  </head>
  <body class="c-app">
    <!-- sidebar -->
    <div
      class="c-sidebar c-sidebar-dark c-sidebar-fixed c-sidebar-lg-show"
      id="sidebar"
    >
      <div class="c-sidebar-brand d-lg-down-none">
        <img
          class="c-sidebar-brand-full"
          style="width: 118px; height: 46px"
          src="public/logo.png"
          alt=""
        />
        <img
          class="c-sidebar-brand-minimized"
          style="width: 46px; height: 46px"
          src="public/favicon.ico"
          alt=""
        />
      </div>
      <ul class="c-sidebar-nav">
        <li class="c-sidebar-nav-item">
          <a href="dashboard.html" class="c-sidebar-nav-link">
            <i class="c-sidebar-nav-icon cil-home"></i> Home
          </a>
        </li>
        <li class="c-sidebar-nav-item">
          <a href="keuangan.html" class="c-sidebar-nav-link">
            <i class="c-sidebar-nav-icon cil-calculator"></i> Keuangan
          </a>
        </li>
        <li class="c-sidebar-nav-item">
          <a href="tinjut.html" class="c-sidebar-nav-link">
            <i class="c-sidebar-nav-icon cil-group"></i> Tindak Lanjut PMK
          </a>
        </li>
        <li class="c-sidebar-nav-item">
          <a href="setoran.html" class="c-sidebar-nav-link">
            <i class="c-sidebar-nav-icon cil-briefcase"></i> Data Setor Pemkab
          </a>
        </li>
        <li class="c-sidebar-nav-item">
          <a href="rekonsiliasi.html" class="c-sidebar-nav-link">
            <i class="c-sidebar-nav-icon cil-check"></i> Rekonsiliasi
          </a>
        </li>
      </ul>
      <button
        class="c-sidebar-minimizer c-class-toggler"
        type="button"
        data-target="_parent"
        data-class="c-sidebar-minimized"
      ></button>
    </div>

    <div class="c-wrapper">
      <!-- header -->
      <header
        class="c-header c-header-light c-header-fixed c-header-with-subheader"
      >
        <button
          class="c-header-toggler c-class-toggler d-lg-none mfe-auto"
          type="button"
          data-target="#sidebar"
          data-class="c-sidebar-show"
        >
          <span class="c-header-toggler-icon"></span>
        </button>
        <button
          class="c-header-toggler c-class-toggler mfs-3 d-md-down-none"
          type="button"
          data-target="#sidebar"
          data-class="c-sidebar-lg-show"
          responsive="true"
        >
          <span class="c-header-toggler-icon"></span>
        </button>
        <ul class="c-header-nav ml-auto mr-4">
          <li class="c-header-nav-item dropdown">
            <a
              class="c-header-nav-link"
              data-toggle="dropdown"
              href="#"
              role="button"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <p>Officer Taspen</p>
            </a>
            <div class="dropdown-menu dropdown-menu-right pt-0">
              <a class="dropdown-item" href="index.html">
                <svg class="c-icon mr-2">
                  <use
                    xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-account-logout"
                  ></use>
                </svg>
                Logout</a
              >
            </div>
          </li>
        </ul>
      </header>

      <!-- content -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-sm-12">
                  <div class="card">
                    <div class="card-header"><strong>Rekonsiliasi</strong></div>
                    <div class="card-body">
                      <div class="row">
                        <div class="form-group row col-12">
                          <label class="col-md-3 col-form-label" for="name"
                            >Program</label
                          >
                          <div class="col-md-9 col-form-label">
                            <select class="form-control" id="ccprogram">
                              <option value="0">Pilih program</option>
                              <option value="jkk">JKK</option>
                              <option value="jkm">JKM</option>
                              <option value="iwp">IWP</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group row col-12">
                          <label class="col-md-3 col-form-label" for="name"
                            >Pemkab</label
                          >
                          <div class="col-md-9 col-form-label">
                            <select class="form-control" id="pemkab">
                              <option value="0">Pilih pemkab</option>
                              <option value="sulsel">Pemprov Sulsel</option>
                              <option value="makassar">Pemkot Makassar</option>
                              <option value="parepare">Pemkot Pare - Pare</option>
                              <option value="maros">Pemkab Maros</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="form-group row col-12">
                          <label class="col-md-3 col-form-label" for="month"
                            >Bulan</label
                          >
                          <div class="col-md-3 col-from-label">
                            <select class="form-control" id="month">
                              <option value="1">Januari</option>
                              <option value="2">Februari</option>
                              <option value="3">Maret</option>
                              <option value="4">April</option>
                              <option value="5">Mei</option>
                              <option value="6">Juni</option>
                              <option value="7">Juli</option>
                              <option value="8">Agustus</option>
                              <option value="9">September</option>
                              <option value="10">Oktober</option>
                              <option value="11">November</option>
                              <option value="12">Desember</option>
                            </select>
                          </div>
                        </div>
                        <div class="form-group row col-12">
                          <label class="col-md-3 col-form-label" for="ccmonth"
                            >Tahun</label
                          >
                          <div class="col-md-3 col-from-label">
                            <select class="form-control" id="year">
                              <option>2022</option>
                              <option>2023</option>
                              <option>2024</option>
                              <option>2025</option>
                              <option>2026</option>
                              <option>2027</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card-footer">
                      <button
                        class="btn btn-sm btn-primary"
                        type="reset"
                        onclick="showRekon()"
                      >
                        Pilih
                      </button>
                    </div>
                  </div>
                  <div class="card" id="toggleRekonsiliasi" style="display: none">
                    <div class="card-body" id="createListKeuangan">
                      <!-- will fill this with automation -->
                    </div>
                    <div class="card-footer">
                      <div class="row justify-content-sm-end">
                        <div class="col-sm-6">
                          <div class="row justify-content-sm-end">
                            <button
                              class="btn btn-sm btn-primary col-sm-3"
                              type="reset"
                              style="margin-right: 2px"
                              id="button-selesai"
                              onclick="enableSelesai()"
                            >
                              Tinjut PMK
                            </button>
                            <button
                              class="btn btn-sm btn-primary col-sm-3 disabled"
                              type="button"
                              data-coreui-toggle="modal"
                              data-coreui-target="#approveModal"
                              style="margin-right: 2px"
                              id="button-rekonsil"
                            >
                              Rekonsiliasi
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="modal fade"
              id="approveModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="myModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-primary" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title">Perhatian</h4>
                  </div>
                  <div class="modal-body">
                    <p>Apakah anda yakin untuk melakukan rekonsiliasi?</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      class="btn btn-primary"
                      type="button"
                      data-coreui-toggle="modal"
                      data-coreui-target="#successModal"
                      data-coreui-dismiss="modal"
                    >
                      Ya
                    </button>
                    <button
                      class="btn btn-secondary"
                      type="button"
                      data-coreui-dismiss="modal"
                    >
                      Tidak
                    </button>
                  </div>
                </div>
                <!-- /.modal-content-->
              </div>
              <!-- /.modal-dialog-->
            </div>
            <div
              class="modal fade"
              id="successModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="myModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-success" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title">Berhasil</h4>
                  </div>
                  <div class="modal-body">
                    <p>Data yang anda input sudah berhasil disimpan</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      class="btn btn-secondary"
                      type="button"
                      data-dismiss="modal"
                      onclick="toggleOff()"
                    >
                      Tutup
                    </button>
                  </div>
                </div>
                <!-- /.modal-content-->
              </div>
              <!-- /.modal-dialog-->
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- Popper.js first, then CoreUI JS -->
    <script src="https://unpkg.com/@coreui/coreui/dist/js/coreui.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/all_variable.js"></script>
    <script>
      function showRekon() {
        $("#toggleRekonsiliasi").show();
        var nama_pemkab = document.querySelector("#pemkab option:checked").value;
        var periode = document.querySelector("#month option:checked").value;
        var program = document.querySelector("#ccprogram option:checked").value;
        peserta_taspen = data_taspen.filter(el => el.periode == periode & el.pemda == nama_pemkab)[0]
        peserta_pemkab = data_pemkab.filter(el => el.periode == periode & el.pemda == nama_pemkab)[0]
        peserta_pmk = data_pmk.filter(el => el.periode == periode & el.pemda == nama_pemkab)[0]
        new_nama_pemkab  = ""
        if (nama_pemkab == 'sulsel') {
          new_nama_pemkab = 'Pemprov Sulsel';
        } else if (nama_pemkab == 'makassar') {
          new_nama_pemkab = 'Pemkot Makassar';
        } else if (nama_pemkab == 'parepare') {
          new_nama_pemkab = 'Pemkot Pare-Pare';
        } else {
          new_nama_pemkab = 'Pemkab ' + nama_pemkab[0].toUpperCase() + nama_pemkab.slice(1)
        }

        induk_taspen = '0'
        induk_pemkab = '0'
        induk_pmk = '0'
        if (program == 'jkk') {
          induk_taspen = peserta_taspen.jkk
          induk_pemkab = peserta_pemkab.jkk
          induk_pmk = peserta_pmk.jkk
        } else if (program == 'jkm') {
          induk_taspen = peserta_taspen.jkm
          induk_pemkab = peserta_pemkab.jkm
          induk_pmk = peserta_pmk.jkm
        } else {
          induk_taspen = peserta_taspen.iwp
          induk_pemkab = peserta_pemkab.iwp
          induk_pmk = peserta_pmk.iwp
        }

        jumlah_peserta_taspen = (parseInt(peserta_taspen.peserta.replace(/[.]+/g,"")) + parseInt(peserta_pmk.peserta.replace(/[.]+/g,""))).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")
        jumlah_peserta_pemkab = peserta_pemkab.peserta

        jumlah_pemkab = parseInt(induk_pemkab.replace(/[.]+/g,""))
        jumlah_taspen = parseInt(induk_taspen.replace(/[.]+/g,"")) + parseInt(induk_pmk.replace(/[.]+/g,""));

        selisih = Math.abs(jumlah_pemkab - jumlah_taspen)
        html = `<div class="row"><div class="col-sm-12"><div class="row"><div class="col-sm-6"><h4 class="card-title">Taspen</h4></div><div class="col-sm-6"><h4 class="card-title" id="nama-pemkab">${new_nama_pemkab}</h4></div></div><hr style="border-top:2px solid"></div><div class="col-sm-12"><br><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item d-flex justify-content-between align-items-center">Peserta<span>${peserta_taspen.peserta}</span></li></ul></div><div class="col-sm-6"><ul class="list-group"><li class="list-group-item d-flex justify-content-between align-items-center">Peserta<span>${peserta_pemkab.peserta}</span></li></ul></div></div><hr size="10"><label for="">Induk</label><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp ${induk_taspen}</li></ul></div><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp ${induk_pemkab}</li></ul></div></div><br><label for="">Susulan</label><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp 0</li></ul></div><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp 0</li></ul></div></div><br><label for="">Rapel</label><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp 0</li></ul><hr></div><div class="col-sm-6"><ul class="list-group"><li class="list-group-item">Rp 0</li></ul></div></div></div><div class="col-sm-12"><h5 class="card-title">PMK</h5><div class="row"><div class="col-sm-6"><hr></div></div></div><div class="col-sm-12"><br><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item d-flex justify-content-between align-items-center">Peserta<span>${peserta_pmk.peserta}</span></li><li class="list-group-item d-flex justify-content-between align-items-center">Nominal<span>Rp ${induk_pmk}</span></li></ul></div></div><hr style="border-top:2px solid"></div><div class="col-sm-12"><br><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item list-group-item-success d-flex justify-content-between align-items-center">Peserta<span>${jumlah_peserta_taspen}</span></li><li class="list-group-item list-group-item-success">= Rp ${jumlah_taspen.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")}</li></ul></div><div class="col-sm-6"><ul class="list-group"><li class="list-group-item list-group-item-success d-flex justify-content-between align-items-center">Peserta<span>${jumlah_peserta_pemkab}</span></li><li class="list-group-item list-group-item-success">= Rp ${jumlah_pemkab.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")}</li></ul></div></div><hr></div><div class="col-sm-12"><div class="row"><div class="col-sm-6"><ul class="list-group"><li class="list-group-item d-flex justify-content-between align-items-center">Selisih<span>Rp ${selisih}</span></li><li class="list-group-item disabled"><div class="form-group row col-6"><label class="col-md-12" for="ccmonth">Jenis Selisih</label><div class="col-md-12"><select class="form-control" id="year"><option>Pilih</option><option>2022</option><option>2023</option><option>2024</option><option>2025</option><option>2026</option><option>2027</option></select></div></div></li></ul></div></div></div></div>`
        document.getElementById("createListKeuangan").innerHTML = html;
      }

      function enableSelesai() {
        $("#button-ubah").removeClass("disabled");
        $("#button-rekonsil").removeClass("disabled");
        $("#button-selesai").addClass("disabled");
        $('select[id="ccmonth"]').attr("disabled", "");
        var redirectWindow = window.open('tinjut.html', '_blank');
        redirectWindow.location;
      }

      function enableUbah() {
        $("#button-selesai").removeClass("disabled");
        $("#button-rekonsil").addClass("disabled");
        $("#button-ubah").addClass("disabled");
        $('select[id="ccmonth"]').removeAttr("disabled", "");
      }

      function toggleOff() {
        window.location.href = 'keuangan.html'
        $("#toggleRekonsiliasi").hide();
      }
    </script>
  </body>
</html>
